Serendip.View={};Serendip.View.Render=function(){return{render:function(b,a,e){a=a.clone();a=a.find(".Placeholder").autoRender(e);e=a.html();b.html(e)}}}();Serendip.FacetsView=function(b,a,e){var c=a.find("#ActiveFacets_Theme"),g=e.find("#ActiveFacets_Prototype");Serendip.ActiveFacetsView(b,c,g);c=a.find("#InactiveFacets_Theme");e=e.find("#FacetRow_Prototype");Serendip.InactiveFacetsView(b,c,e);b.on("views.init",function(){a.hide()});b.on("render",function(d){"undefined"!=typeof d.facet_counts&&a.fadeIn("slow")});return{}};Serendip.ActiveFacetsView=function(b,a,e){function c(a){var c=a.attr("facetname"),a=a.attr("facetvalue");b.trigger("facet.remove",{id:c,value:a});b.search()}var g=null;b.on("views.init",function(){g=a.find(".inactive");g.hide()});b.on("render.facets.active",function(b){b&&0<b.length?Serendip.View.Render.render(a,e,{activeFacet:b}):a.html("");0==b.length&&a.html(g.html());a.find("span.remove").off("click").on("click",function(){var a=$(this).parent().find("a");c(a);return!1});a.find("a").off("click").on("click",
function(){c($(this));return!1})});return{}};Serendip.InactiveFacetsView=function(b,a,e){Serendip.ShowMoreFacetsView(b,a,e);b.on("render.facets.inactive",function(c,g){var d;d=[];for(var m=0;m<g.length;m++){var f=g[m],h;h=f.facet;f=f.values;if(""==f)h="";else{h={facetName:h.id,facetHeader:h.header};var f={facetRow:f},j=e.clone(),j=j.find(".Placeholder").autoRender(h);j.find(".FacetValues").autoRender(f);h=j.html()}d.push(h)}d=d.join("");a.html(d);b.trigger("render.facets.showmore",c);a.find(".facetRow a").off("click").on("click",function(){var a=
$(this),c=a.attr("facetname"),g=a.attr("facetvalue");a.attr("active");b.trigger("facet.add",{id:c,value:g});b.search();return!1})});return{}};Serendip.ShowMoreFacetsView=function(b,a,e){b.on("render.facets.showmore",function(b){a.find(".moreFacetsTxt").show();for(var g=0;g<b.length;g++){for(var d=b[g],m=d.facet,d=d.values,f=[],h=m.minFacetsToDisplay,j=Math.min(m.maxFacetsToDisplay+h,d.length);h<j;h++)f.push(d[h]);d=f;0<d.length?(d={facetRow:d},f=e.clone().find(".FacetValues"),f=f.autoRender(d),d=f.html(),a.find("."+m.id+" .MoreFacetsValues").html(d).hide()):a.find("."+m.id+" .moreFacetsTxt").hide()}a.find("a.moreFacets").off("click").on("click",
function(){var b=$(this).attr("facetname"),c=a.find("."+b+" .MoreFacetsValues"),g=a.find("."+b+" .moreFacetsTxt"),b=a.find("."+b+" .lessFacetsTxt");"none"==c.css("display")?(c.slideDown("slow",function(){$(this).show()}),g.hide(),b.show()):(c.slideUp("slow",function(){$(this).hide()}),b.hide(),g.show());return!1})})};Serendip.ResultView=function(b){function a(a,b,d){b="undefined"==typeof b?a[d]:b[a.id][d];"undefined"==typeof b&&(b=a[d]);return b}var e={};b.on("render",function(c){var g=c.response.docs,d=[];for(i=0;i<g.length;i++){for(var m=g[i],f=c.highlighting,h=b.fieldConfig,j=b.fields,n=b.highlightFields,l={},k=0;k<j.length;k++)l[j[k]]=a(m,f,j[k]);for(k=0;k<n.length;k++)l[n[k]]=a(m,f,n[k]);m=l;f={};j=void 0;for(j in h){n=h[j];l=n.name;k=void 0;m[l]&&(k=m[l]);Serendip.Utils.isArray(k)&&(k=k.join(""));l=k;if(n.isDate&&
l)try{l=Serendip.Utils.convertISOFormatToDate(l).format(n.dateFormat)}catch(p){l="1-01-01T00:00:00Z"==l?"":"Warning: expected date value, but got: "+l}f[n.id]=l}d.push(f)}e.render(d)});e.render=function(){};return e};Serendip.PagerView=function(b,a,e){function c(a,b,c,d,g){return{page:a,regularPageActive:b,currentPageActive:c,nextPageActive:d,prevPageActive:g}}var g=10,d=0,m=!1;b.on("search",function(){m||(d=0)});b.on("render",function(f){d=f.response.start;var f=Math.ceil(f.response.numFound/g),h=Math.ceil(d/g)+1,j=h-5+1,n=h+5+1;1>j&&(j=1);n>f&&(n=f+1);var l=n-j;10>l&&(n+=10-l+1);1>j&&(j=1);n>f&&(n=f+1);l=j;j=[];if(1<h){var k=c(h-1,"inactive","inactive","inactive","active");j.push(k)}for(;l<n;l++){var k="inactive",
p="active";l==h&&(k="active",p="inactive");k=c(l,p,k,"inactive","inactive");j.push(k)}h<f&&(k=c(h+1,"inactive","inactive","active","inactive"),j.push(k));h={pageRow:j};1<f?Serendip.View.Render.render(a,e,h):a.html("");a.find("li a").off("click").on("click",function(){var a=$(this).attr("page");d=(a-1)*g;m=!0;b.search();return m=!1})});b.on("initFromQueryStr",function(a,b){d=b.Page?(b.Page-1)*g:0});b.on("saveInQueryStr",function(a){a("Page",d/g+1,2)});b.on("buildRequest",function(a){a("&start="+d)});
b.on("resultsPrPageChanged",function(a){g=a})};Serendip.SearchView=function(b){var a={getSearchValue:function(){return""},setSearchValue:function(){}};b.on("initFromQueryStr",function(b,c){a.setSearchValue(c.query)});b.on("saveInQueryStr",function(b){var c=a.getSearchValue();(c=encodeURIComponent(c))&&""!=c&&b("query",c,1)});b.on("buildRequest",function(b){var c=a.getSearchValue();if("*"==c[0]||"?"==c[0])c=c.substring(1,c.length),a.setSearchValue(c);""==c&&(c="*:*");c=encodeURIComponent(c);b("&q="+c)});return a};Serendip.SortingView=function(b){var a={sortValueName:"SortBy",sortDirectionName:"OrderBy",sortAscName:"asc",sortDescName:"desc"},e="",c="";b.on("renderFinished",function(){var g=b.getIdForFieldName(e);a.removeAllActiveSortfields();a.makeCurrentSortfieldActive(g,c);a.bindEvents()});b.on("initFromQueryStr",function(b,d){var m=d[a.sortValueName];if(m){var f=d[a.sortDirectionName]==a.sortDescName?"desc":"asc";e=m;c=f}});b.on("saveInQueryStr",function(b){if(e&&c&&"relevans"!=e){var d;d="desc"==c?a.sortDescName:
a.sortAscName;b(a.sortValueName,e,5);b(a.sortDirectionName,d,5)}});b.on("buildRequest",function(a){e&&(c&&"relevans"!=e)&&a("&sort="+e+" "+c)});a.bindEvents=function(){};a.removeAllActiveSortfields=function(){};a.makeCurrentSortfieldActive=function(){};a.sort=function(a,d){e=b.getFieldNameForId(a);c=d;b.search()};a.GetSortDirection=function(a){var b="asc",a=a.split(" ");0<a.length&&"desc"==a[a.length-1]&&(b="desc");return b};a.ReverseSortDirection=function(a){return"asc"==a?"desc":"asc"};return a};Serendip.ResultPrPageView=function(b){var a={resultsToDisplay:10,resultsToDisplayName:"Results"};b.on("render",function(){a.render()});b.on("initFromQueryStr",function(e,c){c[a.resultsToDisplayName]&&(a.resultsToDisplay=c[a.resultsToDisplayName],b.trigger("resultsPrPageChanged",a.resultsToDisplay))});b.on("saveInQueryStr",function(b){b(a.resultsToDisplayName,a.resultsToDisplay,2)});b.on("buildRequest",function(b){b("&rows="+a.resultsToDisplay)});a.render=function(){};return a};Serendip.InProgressView=function(b,a){b.on("views.init",function(){a.hide()});b.on("wait",function(){a.show()});b.on("render",function(){a.hide()})};
