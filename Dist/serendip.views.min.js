Serendip.View={};Serendip.View.Render=function(){return{render:function(a,c,d){c=c.clone();c=c.find(".Placeholder").autoRender(d);d=c.html();a.html(d)}}}();Serendip.FacetsView=function(a,c,d){var j=c.find("#ActiveFacets_Theme"),b=d.find("#ActiveFacets_Prototype");Serendip.ActiveFacetsView(a,j,b);j=c.find("#InactiveFacets_Theme");d=d.find("#FacetRow_Prototype");Serendip.InactiveFacetsView(a,j,d);a.on("views.init",function(){c.hide()});a.on("render",function(b){"undefined"!=typeof b.facet_counts&&c.fadeIn("slow")});return{}};Serendip.ActiveFacetsView=function(a,c,d){function j(b){var c=b.attr("facetname"),b=b.attr("facetvalue");a.trigger("facet.remove",{id:c,value:b});a.search()}var b=null;a.on("views.init",function(){b=c.find(".inactive");b.hide()});a.on("render.facets.active",function(a){a&&0<a.length?Serendip.View.Render.render(c,d,{activeFacet:a}):c.html("");0==a.length&&c.html(b.html());c.find("span.remove").off("click").on("click",function(){var b=$(this).parent().find("a");j(b);return!1});c.find("a").off("click").on("click",
function(){j($(this));return!1})});return{}};Serendip.InactiveFacetsView=function(a,c,d){Serendip.ShowMoreFacetsView(a,c,d);a.on("render.facets.inactive",function(j,b){var e;e=[];for(var h=0;h<b.length;h++){var f=b[h],g;g=f.facet;f=f.values;if(""==f)g="";else{g={facetName:g.id,facetHeader:g.header};var f={facetRow:f},l=d.clone(),l=l.find(".Placeholder").autoRender(g);l.find(".FacetValues").autoRender(f);g=l.html()}e.push(g)}e=e.join("");c.html(e);a.trigger("render.facets.showmore",j);c.find(".facetRow a").off("click").on("click",function(){var b=
$(this),c=b.attr("facetname"),f=b.attr("facetvalue");b.attr("active");a.trigger("facet.add",{id:c,value:f});a.search();return!1})});return{}};Serendip.ShowMoreFacetsView=function(a,c,d){a.on("render.facets.showmore",function(a){c.find(".moreFacetsTxt").show();for(var b=0;b<a.length;b++){for(var e=a[b],h=e.facet,e=e.values,f=[],g=h.minFacetsToDisplay,l=Math.min(h.maxFacetsToDisplay+g,e.length);g<l;g++)f.push(e[g]);e=f;0<e.length?(e={facetRow:e},f=d.clone().find(".FacetValues"),f=f.autoRender(e),e=f.html(),c.find("."+h.id+" .MoreFacetsValues").html(e).hide()):c.find("."+h.id+" .moreFacetsTxt").hide()}c.find("a.moreFacets").off("click").on("click",
function(){var b=$(this).attr("facetname"),a=c.find("."+b+" .MoreFacetsValues"),f=c.find("."+b+" .moreFacetsTxt"),b=c.find("."+b+" .lessFacetsTxt");"none"==a.css("display")?(a.slideDown("slow",function(){$(this).show()}),f.hide(),b.show()):(a.slideUp("slow",function(){$(this).hide()}),b.hide(),f.show());return!1})})};Serendip.ResultView=function(a,c,d){function j(b,a,c){a="undefined"==typeof a?b[c]:a[b.id][c];"undefined"==typeof a&&(a=b[c]);return a}a.on("render",function(b){var e=b.response.docs,h=[];for(i=0;i<e.length;i++){for(var f=e[i],g=b.highlighting,l=a.fieldConfig,p=a.fields,m=a.highlightFields,k={},n=0;n<p.length;n++)k[p[n]]=j(f,g,p[n]);for(n=0;n<m.length;n++)k[m[n]]=j(f,g,m[n]);f=k;g={};p=void 0;for(p in l){m=l[p];k=m.name;n=void 0;f[k]&&(n=f[k]);Serendip.Utils.isArray(n)&&(n=n.join(""));k=n;if(m.isDate&&
k)try{k=Serendip.Utils.convertISOFormatToDate(k).format(m.dateFormat)}catch(q){k="1-01-01T00:00:00Z"==k?"":"Warning: expected date value, but got: "+k}g[m.id]=k}h.push(g)}Serendip.View.Render.render(c,d,{docs:h})})};Serendip.PagerView=function(a,c,d){function j(b,a,c,d,e){return{page:b,regularPageActive:a,currentPageActive:c,nextPageActive:d,prevPageActive:e}}var b=10,e=0,h=!1;a.on("search",function(){h||(e=0)});a.on("render",function(f){e=f.response.start;var f=Math.ceil(f.response.numFound/b),g=Math.ceil(e/b)+1,l=g-5+1,p=g+5+1;1>l&&(l=1);p>f&&(p=f+1);var m=p-l;10>m&&(p+=10-m+1);1>l&&(l=1);p>f&&(p=f+1);m=l;l=[];if(1<g){var k=j(g-1,"inactive","inactive","inactive","active");l.push(k)}for(;m<p;m++){var k="inactive",
n="active";m==g&&(k="active",n="inactive");k=j(m,n,k,"inactive","inactive");l.push(k)}g<f&&(k=j(g+1,"inactive","inactive","active","inactive"),l.push(k));g={pageRow:l};1<f?Serendip.View.Render.render(c,d,g):c.html("");c.find("li a").off("click").on("click",function(){var c=$(this).attr("page");e=(c-1)*b;h=!0;a.search();return h=!1})});a.on("initFromQueryStr",function(a,c){e=c.Page?(c.Page-1)*b:0});a.on("saveInQueryStr",function(a){a("Page",e/b+1,2)});a.on("buildRequest",function(b){b("&start="+e)});
a.on("resultsPrPageChanged",function(a){b=a})};Serendip.SearchView=function(a,c){var d=null;a.on("views.init",function(){d=c.find(".input");c.find(".button").click(function(){a.search(d.val());return!1})});a.on("initFromQueryStr",function(a,b){d.val(b.query)});a.on("saveInQueryStr",function(a){var b=d.val();(b=encodeURIComponent(b))&&""!=b&&a("query",b,1)});a.on("buildRequest",function(a){var b=d.val();if("*"==b[0]||"?"==b[0])b=b.substring(1,b.length),d.val(b);""==b&&(b="*:*");b=encodeURIComponent(b);a("&q="+b)})};Serendip.SortingView=function(a,c){var d="",j="";a.on("renderFinished",function(){var b;a:{var e=a.fieldConfig;for(b=0;b<e.length;b++){var h=e[b];if(h.name==d){b=h.id;break a}}b=""}e=j;b+="Row";c.find(".sortfield .active").removeClass("active").addClass("inactive");b=$("."+b);h="asc"==e?"desc":"asc";b.find(".sortfield ."+e).removeClass(e).addClass(h);b.find(".sortfield .inactive").removeClass("inactive").addClass("active");b.find(".sortfield a").attr("direction",h);c.find("th .sortfield a").off("click").on("click",
function(){var b=$(this).attr("sort"),c=$(this).attr("direction");a:{for(var e=a.fieldConfig,h=0;h<e.length;h++){var m=e[h];if(m.id==b){b=m.name;break a}}b=""}d=b;j=c;a.search();return!1})});a.on("initFromQueryStr",function(b,a){var c=a.SortBy;if(c){var f=a.OrderBy;f||(f="asc");d=c;j=f}});a.on("saveInQueryStr",function(b){d&&(j&&"relevans"!=d)&&(b("SortBy",d,5),b("OrderBy",j,5))});a.on("buildRequest",function(b){d&&(j&&"relevans"!=d)&&b("&sort="+d+" "+j)})};Serendip.ResultInfoView=function(a,c,d){a.on("render",function(a){Serendip.View.Render.render(c,d,{numDocs:a.response.numFound,time:a.responseHeader.QTime})})};Serendip.ResultPrPageView=function(a,c){var d=10;a.on("views.init",function(){c.find("select").change(function(){d=$(this).val();a.search()});a.on("render",function(){c.find("select").val(d)});a.on("initFromQueryStr",function(c,b){b.Results&&(d=b.Results,a.trigger("resultsPrPageChanged",d))});a.on("saveInQueryStr",function(a){a("Results",d,2)});a.on("buildRequest",function(a){a("&rows="+d)})})};Serendip.InProgressView=function(a,c){a.on("views.init",function(){c.hide()});a.on("wait",function(){c.show()});a.on("render",function(){c.hide()})};
