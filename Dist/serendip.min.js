var Serendip=function(){};Serendip.Events=function(){var c={},a={};c.on=function(b,d,e){var g=a||(a={});(g[b]||(g[b]=[])).push({callback:d,context:e})};c.off=function(b,d,e){!d&&!e&&delete a[b];for(var b=a[b]||[],g=0;g<b.length;g++)d&&b[g].callback!==d||e&&b[g].context!==e||b.splice(g,1)};c.trigger=function(b){for(var d=Array.prototype.slice.call(arguments,1),e=(a||{})[b]||[],g=0;g<e.length;g++){var f=e[g];f.callback.apply(f.context||c,d)}};return c}();Serendip.Utils=function(){var c={formatISODate:function(a,b){var d="";try{d=c.convertISOFormatToDate(a).format(b)}catch(e){d="Could not parse date: "+a}return d},convertISOFormatToDate:function(a){if("string"!==typeof a)throw"ISODate, convert: input must be a string";a=a.match(/^(\d{4})-(\d{2})-(\d{2})[T ](\d{2}):(\d{2}):(\d{2}(?:\.\d+)?)(Z|(([+-])(\d{2}):(\d{2})))$/i);if(!a)throw"ISODate, convert: Illegal format";return new Date(Date.UTC(a[1],a[2]-1,a[3],a[4],a[5],a[6]|0,1E3*a[6]-1E3*(a[6]|0)|0,
a[7])+("Z"===a[7].toUpperCase()?0:(3600*a[10]+60*a[11])*("-"===a[9]?1E3:-1E3)))},isArray:function(a){return a&&!a.propertyIsEnumerable("length")&&"object"===typeof a&&"number"===typeof a.length},trim:function(a){return a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},splitSolrMultiValue:function(a){for(var b=[],a=a.split("]"),d=0;d<a.length;d++){var e=a[d].replace(/\[/g,""),e=e.replace(/]/g,""),e=c.trim(e);0<e.length&&b.push(e)}return b},setupEvents:function(a){a.on=Serendip.Events.on;a.trigger=Serendip.Events.trigger}};
return c}();Serendip.Ajax=function(){return{get:function(c,a,b){$.ajax({scriptCharset:"utf-8",type:"GET",url:c,data:"",dataType:"json",contentType:"text/plain; charset=utf-8",timeout:5E3,success:a,error:function(a,e,g){e=!1;try{-1<g.indexOf("<html")&&(e=!0)}catch(c){console&&console.log(c.toSource())}a=jQuery.parseJSON(a.responseText);console&&(console.log(a),console.log(g.toSource()));""==a&&(a="Unable to contact server.");b(a,e)}})}}}();
Serendip.History=function(){function c(b){b||(b=window.location.search);0<b.length&&a.trigger("history.change",b)}var a={};Serendip.Utils.setupEvents(a);a.init=function(){$.historyInit(c,"index.html")};a.load=function(a){$.historyLoad(a)};return a}();Serendip.Core=function(c,a){function b(){if(!1==_enableAllFields){for(var a=[],d=0;d<h.fieldConfig.length;d++){var b=h.fieldConfig[d];b.isEnabled&&a.push(b.name)}h.removeQueryParam("fl");h.addQueryParam("fl",a.join(","))}}function d(a,d){var b=a.header.toLowerCase(),e=d.header.toLowerCase();return b<e?-1:b>e?1:0}function e(a,d){var b=a.sortIndex,e=d.sortIndex;return b<e?-1:b>e?1:0}function g(a){h.trigger("wait");a&&h.saveHistoryItem();var d="";h.trigger("buildRequest",function(a){d+=a});for(var a=
"",b=0;b<_queryParams.length;b++)a+=_queryParams[b],b<_queryParams.length-1&&(a+="&");a=solrUrl+"?"+a;c.get(a+(d+"&wt=json"),l,f)}function f(a,d){alert(a);d&&redirectToLogin()}function l(a){null==a&&redirectToLogin();h.trigger("renderStart");h.trigger("render",a);h.trigger("renderFinished")}var h={fieldConfig:[],fields:[],facets:[],highlightFields:[]};_queryParams=[];_enableAllFields=!1;clickType=sortQuery="";cplIndex=-1;solrUrl="";Serendip.Utils.setupEvents(h);h.init=function(){h.trigger("views.init");
h.fieldConfig.sort(d);b();h.trigger("views.init.done");a.on("history.change",function(a){for(var d=a=decodeURIComponent(a),b=d.split("&"),e={},c=0;c<b.length;c++){var f=b[c].split("=");e[f[0]]=f[1]}b=d.replace("!/","").split("/");for(c=0;c<b.length-1;c+=2)e[""+b[c]+""]=b[c+1];h.trigger("initFromQueryStr",a,e);g(!1)});a.init()};h.addFacet=function(a){h.facets.push(a);if(0<a.facets.length)for(var d=0;d<a.facets.length;d++)h.addFacet(a.facets[d])};h.addFieldConfig=function(a){h.fieldConfig.push(a);h.fields.push(a.name)};
h.enableAllFields=function(a){(_enableAllFields=a)?h.addQueryParam("fl","*"):h.removeQueryParam("fl");b()};h.setHighlightFields=function(a){addQueryParam("hl.fl",a.join(" "));highlightFields=a};h.removeQueryParam=function(a){delete _queryParams[a]};h.addQueryParam=function(a,d){var b=a+"="+d,e=!1,g;for(g in _queryParams)-1!=_queryParams[g].indexOf(a)&&(_queryParams[g]=b,e=!0);e||_queryParams.push(a+"="+d)};h.setSolrUrl=function(a){solrUrl=a};h.saveHistoryItem=function(){var d="",b=[];h.trigger("saveInQueryStr",
function(a,d,e){b.push({id:a,value:d,sortIndex:e})});for(var b=b.sort(e),g=0;g<b.length;g++)var c=b[g],d=d+"/"+c.id+"/"+c.value;a.load("!"+d)};h.getIdForFieldName=function(a){for(var d=0;d<h.fieldConfig.length;d++){var b=h.fieldConfig[d];if(b.name==a)return b.id}return""};h.getFieldNameForId=function(a){for(var d=0;d<h.fieldConfig.length;d++){var b=h.fieldConfig[d];if(b.id==a)return b.name}return""};h.search=function(){h.trigger("search");g(!0)};return h}(Serendip.Ajax,Serendip.History);
var serendip=Serendip.Core;Serendip.Facets=function(c){function a(a,b,g){var b=decodeURIComponent(b),c=e[a],m=d[a];m||(m={},m.id=c.id,m.values=[]);if(g)m.values.push(b);else{g=[];for(c=0;c<m.values.length;c++)m.values[c]!=b&&g.push(m.values[c]);m.values=g}d[a]=m}var b={},d={},e=null,g=null;c.on("views.init",function(){g=c.facets;e=[];for(var f in g){var l=g[f];e[l.id]=l}c.on("views.init.done",function(){c.trigger("init.facets.core",b)});c.on("initFromQueryStr",function(a,b){d={};for(var e=0;e<g.length;e++){var c=g[e],f=c.id+
"";b[f]&&(f=b[f],facetQuery={},facetQuery.id=c.id,facetQuery.values=f.split(","),d[c.id]=facetQuery)}});c.on("saveInQueryStr",function(a){for(var b in d){var e=d[b].values;e&&0<e.length&&a(b,e.join(","),6)}});c.on("buildRequest",function(a){for(var b,c=g,f="",j=0;j<c.length;j++)f+=c[j].getQuery(),j<c.length-1&&(f+="&");a("&facet=true&"+f);c=[];for(b in d)f=e[b],j=d[b],0<j.values.length&&(f=f.getActiveQuery(j.values),c.push(f));b=0<c.length?"&"+c.join("&"):"";a("&"+b)});c.on("facet.remove",function(d){a(d.id,
d.value,!1)});c.on("facet.add",function(d){a(d.id,d.value,!0)})});b.getActiveFacetsQueriesMap=function(){return d};b.getActiveFacetsMap=function(){return e};return b}(serendip);Serendip.Facet=function(){var c={facetType:"text",name:null,activeHeader:null,header:null,minFacetsToDisplay:null,maxFacetsToDisplay:null,facets:[],parents:[],addSubFacet:function(a){c.facets.push(a);a.addParent(c)},addParent:function(a){c.parents.push(a)},getActiveQuery:function(a){var b="fq={!tag="+c.id+"}"+c.name,a=c.getActiveQueryValues(a);return b+(":("+a+")")},getActiveQueryValues:function(a){for(var b="",d=0;d<a.length;d++)var e=encodeURIComponent(a[d]),b=b+c.getActiveQueryValue(e);return b},
getActiveQueryValue:function(a){return'"'+a+'" '},getQuery:function(){return"facet.field={!ex="+c.id+"}"+c.name},parseActiveValue:function(a){var b="{!tag="+c.id+"}"+c.name+":(",d=a.substring(0,b.length);return b!=d?"":a.substring(b.length,a.length-1)},parseActiveFacetValue:function(a){var b=[],a=c.parseActiveValue(a);if(""!=a)for(var a=a.split(/\"\s/),d=0;d<a.length;d++){var e=a[d].replace(/\"/g,""),e=Serendip.Utils.trim(e);b.push(e)}return b},process:function(a){a=a.facet_counts.facet_fields[c.name];
return typeof("undefined"!=a)?a:[]},processActive:function(a){var b=encodeURIComponent(a),a=c.getFormattedValue(a);return c.processActiveField(b,a)},processActiveField:function(a,b){return{header:c.activeHeader,name:c.id,value:a,displayValue:b,isActive:"true"}},getFacetValue:function(a){return a},getFormattedValue:function(a){return a}};return c};Serendip.DateFacet=function(c){function a(a,b,c,f,l){var h=a[b+1],k={};k.from=a[b];var f=f.gap,m=1,n=1,j=0;"-"==f[0]&&(m=-1);f.match("YEARS")&&(j=f.substring(1,f.length-5),n=365);f.match("MONTHS")&&(j=f.substring(1,f.length-6),n=30);f.match("DAYS")&&(j=f.substring(1,f.length-4));f.match("YEAR")&&(j=f.substring(1,f.length-4),n=365);f.match("MONTH")&&(j=f.substring(1,f.length-5),n=30);f.match("DAY")&&(j=f.substring(1,f.length-3));var j=parseInt(j),p,f=k.from,m=j*m*n,n="";try{p=Serendip.Utils.convertISOFormatToDate(f),
p.setDate(p.getDate()+m),n=p.format("isoDateTime")+"Z"}catch(q){n="Could not parse date: "+f}p=n;k.to="asc"==l?b+2<a.length?a[b+2]:p:p;c.push(k);c.push(h)}var b=Serendip.Facet(c);b.facetType="date";b.dateStart=null;b.dateEnd=null;b.dateGap=null;b.dateFormat=null;b.sortDir="asc";b.getQuery=function(){var a="facet.date={!ex="+b.id+"}"+b.name,e="&f."+b.name+".facet.date",a=a+(e+".start="+encodeURIComponent(b.dateStart)),a=a+(e+".end="+encodeURIComponent(b.dateEnd));return a+=e+".gap="+encodeURIComponent(b.dateGap)};
b.getActiveQueryValue=function(a){return"["+a+"] "};b.getFacetValue=function(a){return a.from+" TO "+a.to};b.getFormattedValue=function(a){var e=Serendip.Utils.formatISODate(a.from,b.dateFormat),a=Serendip.Utils.formatISODate(a.to,b.dateFormat);return e+" - "+a};b.parseActiveFacetValue=function(a){a=b.parseActiveValue(a);return""!=a?Serendip.Utils.splitSolrMultiValue(a):[]};b.processActive=function(a){var e=a.split(" TO "),e=b.getFormattedValue({from:e[0],to:e[1]}),a=encodeURIComponent(a);return b.processActiveField(a,
e)};b.process=function(d){var d=d.facet_counts.facet_dates[b.name],e=[],c;for(c in d)"gap"!=c&&"end"!=c&&(e.push(c),e.push(d[c]));c=[];if("asc"==b.sortDir)for(var f=0;f<e.length;f+=2)a(e,f,c,d,"asc");else for(f=e.length-2;-1<f;f-=2)a(e,f,c,d,"desc");return c};return b};Serendip.RangeFacet=function(c){var a=Serendip.Facet(c);a.facetType="range";a.rangeStart=null;a.rangeEnd=null;a.rangeGap=null;a.getQuery=function(){var b="facet.range={!ex="+a.id+"}"+a.name,d="&f."+a.name+".facet.range",b=b+(d+".start="+encodeURIComponent(a.rangeStart)),b=b+(d+".end="+encodeURIComponent(a.rangeEnd));return b+=d+".gap="+encodeURIComponent(a.rangeGap)};a.getActiveQueryValue=function(a){return"["+a+"] "};a.getFacetValue=function(a){return a.from+" TO "+a.to};a.getFormattedValue=function(a){return a.from+
" - "+a.to};a.parseActiveFacetValue=function(b){b=a.parseActiveValue(b);return""!=b?Serendip.Utils.splitSolrMultiValue(b):[]};a.isFacetFieldActive=function(){return!1};a.processActive=function(b){var d=b.split(" TO "),d=a.getFormattedValue({from:d[0],to:d[1]}),b=encodeURIComponent(b);return a.processActiveField(b,d)};a.process=function(b){for(var d=b.facet_counts.facet_ranges,b=d[a.name].counts,d=d[a.name].gap,c=[],g=0;g<b.length;g+=2){var f=parseInt(b[g]),l=b[g+1],h={from:f};h.to=f+d-1;c.push(h);
c.push(l)}return c};return a};Serendip.QueryFacet=function(c){var a=Serendip.Facet(c);a.facetType="query";var b=[];a.addQuery=function(a){b.push(a)};a.getQuery=function(){for(var d="",c=b.length,g=0;g<c;g++)d+="facet.query={!ex="+a.id+" key="+a.id+"range["+g+"]}"+a.name+":"+b[g].query,g<c-1&&(d+="&");return d};a.getFacetValue=function(a){return a.value};a.getFormattedValue=function(a){return a.formattedValue};a.getActiveQueryValues=function(a){return a[a.length-1]};a.parseActiveFacetValue=function(b){var c=[],b=a.parseActiveValue(b);
""!=b&&c.push(b);return c};a.process=function(d){for(var d=d.facet_counts.facet_queries,c=[],g=0;g<b.length;g++){var f=b[g],l=d[a.id+"range["+g+"]"];c.push({formattedValue:f.header,value:f.query});c.push(l)}return c};a.processActive=function(d){var c=d,g;for(g in b){var f=b[g];f.query==d&&(c=f.header)}d=encodeURIComponent(d);return a.processActiveField(d,c)};return a};Serendip.FacetsRenderInactive=function(c){function a(a,b,c){c=b.getFacetValue(c);a=b.parseActiveFacetValue(a);for(b=0;b<a.length;b++)if(c==a[b])return!0;return!1}var b=null;c.on("init.facets.core",function(a){b=a});c.on("render",function(d){var e=[];if("undefined"!=typeof d.facet_counts){for(var g=c.facets,f=[],l=0;l<g.length;l++){var h=g[l],k;a:{k=h.parents;for(var m=b.getActiveFacetsQueriesMap(),n=0;n<k.length;n++){var j=k[n],p;for(p in m)if(p==j.id){k=!0;break a}}k=0==k.length?!0:!1}k&&f.push(h)}for(g=
0;g<f.length;g++){l=d;h=f[g];p=h.process(l);k=void 0;if(p){k=p;p=[];m=[];for(n=0;n<k.length;n+=2){var j=k[n],q=k[n+1];if(0<q||-1==q)m.push(j),m.push(q)}k=m;m=k.length;for(n=0;n<m;n+=2){var r=k[n],j=k[n+1];if(""!=r){var t;a:{q=h;t=r;var s=l.responseHeader.params.fq;if(s)if(!Serendip.Utils.isArray(s)||1==s[0].length){if(a(s,q,t)){t=!0;break a}}else for(var u=0;u<s.length;u++)if(a(s[u],q,t)){t=!0;break a}t=!1}q=h;s=q.getFormattedValue(r);r=q.getFacetValue(r);r=encodeURIComponent(r);u=void 0;u=t?"":{name:q.id,
value:r,displayValue:s,countValue:j,countValueCls:"count"+j,isActive:"false"};j=u;""!=j&&p.push(j)}}k={facet:h,values:p}}else k="";l=k;""!=l&&e.push(l)}}d=[];for(f=0;f<e.length;f++){g=e[f];l=g.values;h=[];p=Math.min(g.facet.minFacetsToDisplay,l.length);for(k=0;k<p;k++)h.push(l[k]);d.push({facet:g.facet,values:h})}c.trigger("render.facets.inactive",e,d)});return{}}(serendip);Serendip.FacetsRenderActive=function(c){var a=null;c.on("init.facets.core",function(b){a=b});c.on("render",function(){var b=[],d=a.getActiveFacetsQueriesMap(),e=a.getActiveFacetsMap(),g;for(g in d){var f=d[g],l=e[g];if(0!=f.values.length)for(var h=0;h<f.values.length;h++){var k=l.processActive(f.values[h]);b.push(k)}}c.trigger("render.facets.active",b)});return{}}(serendip);Serendip.ActiveFacetsView=function(c){var a={};c.on("render.facets.active",function(b){a.render(b);a.bindEvents()});a.render=function(){};a.bindEvents=function(){};a.handleFacetClick=function(a,d){c.trigger("facet.remove",{id:a,value:d});c.search()};return a};Serendip.InactiveFacetsView=function(c){var a={};c.on("render.facets.inactive",function(b,d){a.render(d);a.bindEvents();c.trigger("render.inactivefacets.done",b)});a.filter=function(a,d){c.trigger("facet.add",{id:a,value:d});c.search()};a.bindEvents=function(){};a.render=function(){};return a};Serendip.ResultView=function(c){function a(a,b,c){b="undefined"==typeof b?a[c]:b[a.id][c];"undefined"==typeof b&&(b=a[c]);return b}var b={};c.on("render",function(d){var e=d.response.docs,g=[];for(i=0;i<e.length;i++){for(var f=e[i],l=d.highlighting,h=c.fieldConfig,k=c.fields,m=c.highlightFields,n={},j=0;j<k.length;j++)n[k[j]]=a(f,l,k[j]);for(j=0;j<m.length;j++)n[m[j]]=a(f,l,m[j]);f={};l=void 0;for(l in h){k=h[l];m=k.name;j=void 0;n[m]&&(j=n[m]);Serendip.Utils.isArray(j)&&(j=j.join(""));m=j;if(k.isDate&&
m)try{m=Serendip.Utils.convertISOFormatToDate(m).format(k.dateFormat)}catch(p){m="1-01-01T00:00:00Z"==m?"":"Warning: expected date value, but got: "+m}f[k.id]=m}g.push(f)}b.render(g)});b.render=function(){};return b};Serendip.PagerView=function(c){var a={pageName:"Page",windowSize:5,pages:10},b=10,d=0,e=!1;c.on("search",function(){e||(d=0)});c.on("render",function(c){d=c.response.start;var c=Math.ceil(c.response.numFound/b),e=Math.ceil(d/b)+1,l=e-a.windowSize+1,h=e+a.windowSize+1;1>l&&(l=1);h>c&&(h=c+1);var k=h-l;k<a.pages&&(h+=a.pages-k+1);1>l&&(l=1);h>c&&(h=c+1);a.render(e,c,l,h);a.bindEvents()});c.on("initFromQueryStr",function(c,e){d=e[a.pageName]?(e[a.pageName]-1)*b:0});c.on("saveInQueryStr",function(c){c(a.pageName,
d/b+1,2)});c.on("buildRequest",function(a){a("&start="+d)});c.on("resultsPrPageChanged",function(a){b=a});a.setPage=function(a){d=(a-1)*b;e=!0;c.search();e=!1};a.bindEvents=function(){};a.render=function(){};return a};Serendip.SearchView=function(c){var a={getSearchValue:function(){return""},setSearchValue:function(){}};c.on("initFromQueryStr",function(b,c){a.setSearchValue(c.query)});c.on("saveInQueryStr",function(b){var c=a.getSearchValue();(c=encodeURIComponent(c))&&""!=c&&b("query",c,1)});c.on("buildRequest",function(b){var c=a.getSearchValue();if("*"==c[0]||"?"==c[0])c=c.substring(1,c.length),a.setSearchValue(c);""==c&&(c="*:*");c=encodeURIComponent(c);b("&q="+c)});return a};Serendip.SortingView=function(c){var a={sortValueName:"SortBy",sortDirectionName:"OrderBy",sortAscName:"asc",sortDescName:"desc"},b="",d="";c.on("renderFinished",function(){var e=c.getIdForFieldName(b);a.removeAllActiveSortfields();a.makeCurrentSortfieldActive(e,d);a.bindEvents()});c.on("initFromQueryStr",function(c,g){var f=g[a.sortValueName];if(f){var l=g[a.sortDirectionName]==a.sortDescName?"desc":"asc";b=f;d=l}});c.on("saveInQueryStr",function(c){if(b&&d&&"relevans"!=b){var g;g="desc"==d?a.sortDescName:
a.sortAscName;c(a.sortValueName,b,5);c(a.sortDirectionName,g,5)}});c.on("buildRequest",function(a){b&&(d&&"relevans"!=b)&&a("&sort="+b+" "+d)});a.bindEvents=function(){};a.removeAllActiveSortfields=function(){};a.makeCurrentSortfieldActive=function(){};a.sort=function(a,g){b=c.getFieldNameForId(a);d=g;c.search()};a.GetSortDirection=function(a){var b="asc",a=a.split(" ");0<a.length&&"desc"==a[a.length-1]&&(b="desc");return b};a.ReverseSortDirection=function(a){return"asc"==a?"desc":"asc"};return a};Serendip.ResultPrPageView=function(c){var a={resultsToDisplay:10,resultsToDisplayName:"Results"};c.on("render",function(){a.render()});c.on("initFromQueryStr",function(b,d){d[a.resultsToDisplayName]&&(a.resultsToDisplay=d[a.resultsToDisplayName],c.trigger("resultsPrPageChanged",a.resultsToDisplay))});c.on("saveInQueryStr",function(b){b(a.resultsToDisplayName,a.resultsToDisplay,2)});c.on("buildRequest",function(b){b("&rows="+a.resultsToDisplay)});a.render=function(){};return a};
